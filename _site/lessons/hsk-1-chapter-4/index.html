<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 1 - Chapter 4 | Mandarin HSK Study Site</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/css/styles.css">  
    
</head>
<body>
    <!-- Bootstrap JS (for Popovers) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">Mandarin HSK Study Site</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="/lessons">Lessons</a></li>
                    <li class="nav-item"><a class="nav-link" href="/readings">Readings</a></li>
                    <li class="nav-item"><a class="nav-link" href="https://chatgpt.com/g/g-67a2f171c0dc8191a6ba6d87bbc9ee91-mandarin-pronunciation-guide"><i class="bi bi-box-arrow-up-right"> ChatGPT æ±‰å­— Coach.</i></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="container">
    <br />
    <br />
    <div class="d-flex justify-content-between align-items-center">
        <h1>HSK 1 - Chapter 4</h1>
    </div>
    <p class="plain-text-body">
</p>
    <br />
    <br />
    <br />
    <br />
    
    <div class="new-words-section"
        data-dictionary="eyLlpbkiOiIocikgIHNoZSIsIuiwgSI6IihyKSAgd2hvIiwi55qEIjoiKHVqKSAgKGJvdW5kIGZvcm0pIGJ1bGwncy1leWU7IHRhcmdldCIsIuaxieivrSI6IihueikgIENoaW5lc2UgbGFuZ3VhZ2UiLCLlk6oiOiIocikgIHdoaWNoPyAoaW50ZXJyb2dhdGl2ZSwgZm9sbG93ZWQgYnkgY2xhc3NpZmllciBvciBudW1lcmFsLWNsYXNzaWZpZXIpIiwi5Zu9IjoiKG4pICBjb3VudHJ5OyBuYXRpb247IHN0YXRlIiwi5ZGiIjoiKHkpICBkZW5zZSB3b29sIGZhYnJpYyAodXNlZCBmb3IgY29hdHMgYW5kIGphY2tldHMpIiwi5LuWIjoiKHIpICAodGhpcmQtcGVyc29uIHNpbmd1bGFyKSAoc2luY2UgdGhlIGVhcmx5IDIwdGggY2VudHVyeSwgdXN1LiBtYWxlKSBoZTsgaGltOyBoaXMiLCLlkIzlraYiOiIobikgIHRvIHN0dWR5IGF0IHRoZSBzYW1lIHNjaG9vbCIsIuaci%2BWPiyI6IihuKSAgZnJpZW5kIn0%3D""
    ></div>
    <br />
    <br />
    <br />
    <br />
    <div class="d-flex justify-content-between align-items-center">
        <h2>Dialogs</h2>
        <div>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="togglePinyin">
                <label class="form-check-label" for="togglePinyin">Show Pinyin</label>
            </div>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="toggleTranslation">
                <label class="form-check-label" for="toggleTranslation">Show Translation</label>
            </div>
        </div>
    </div>

    
        <hr />
        <div class="hanzi-section" 
            data-title="Dialogue 1: Introducing a Friend"
            data-hanzi="A: ä½ å¥½ï¼å¥¹æ˜¯è°ï¼Ÿ
B: å¥¹æ˜¯æˆ‘çš„åŒå­¦ã€‚å¥¹å«æŽæœˆã€‚
A: å¥¹æ˜¯ä¸­å›½äººå—ï¼Ÿ
B: æ˜¯ï¼Œå¥¹æ˜¯ä¸­å›½äººã€‚ä½ å‘¢ï¼Ÿ
A: æˆ‘æ˜¯ç¾Žå›½äººã€‚" 
            data-translation="W1siQTog5L2g5aW977yB5aW55piv6LCB77yfXG4iLCJBOiBIZWxsbyEgV2hvIGlzIHNoZT9cbiJdLFsiQjog5aW55piv5oiR55qE5ZCM5a2m44CC5aW55Y%2Br5p2O5pyI44CCXG4iLCJCOiBTaGUgaXMgbXkgY2xhc3NtYXRlLiBIZXIgbmFtZSBpcyBMaSBZdWUuXG4iXSxbIkE6IOWlueaYr%2BS4reWbveS6uuWQl%2B%2B8n1xuIiwiQTogSXMgc2hlIENoaW5lc2U%2FXG4iXSxbIkI6IOaYr%2B%2B8jOWlueaYr%2BS4reWbveS6uuOAguS9oOWRou%2B8n1xuIiwiQjogWWVzLCBzaGUgaXMgQ2hpbmVzZS4gV2hhdCBhYm91dCB5b3U%2FXG4iXSxbIkE6IOaIkeaYr%2Be%2BjuWbveS6uuOAgiIsIkE6IEkgYW0gQW1lcmljYW4uIl1d"
            data-dictionary="eyJBIjoiKHgpICAoc2xhbmcpIChUdykgdG8gc3RlYWwiLCLkvaDlpb0iOiIobCkgIGhlbGxvIiwi5aW5IjoiKHIpICBzaGUiLCLmmK8iOiIodikgIHZhcmlhbnQgb2Yg5pivW3NoaTRdIiwi6LCBIjoiKHIpICB3aG8iLCJCIjoiKHgpICBldXBoZW1pc3RpYyB2YXJpYW50IG9mIOWxhFtiaTFdIiwi5oiRIjoiKHIpICBJOyBtZTsgbXkiLCLnmoQiOiIodWopICAoYm91bmQgZm9ybSkgYnVsbCdzLWV5ZTsgdGFyZ2V0Iiwi5ZCM5a2mIjoiKG4pICB0byBzdHVkeSBhdCB0aGUgc2FtZSBzY2hvb2wiLCLlj6siOiIodikgIHZhcmlhbnQgb2Yg5Y%2BrW2ppYW80XSIsIuS4reWbvSI6IihucykgIENoaW5hIiwi5Lq6IjoiKG4pICBwZXJzb247IHBlb3BsZSIsIue%2BjuWbvSI6IihucykgIFVuaXRlZCBTdGF0ZXM7IFVTQTsgVVMifQ%3D%3D"
            data-markdown="%0A%23%23%20Grammar%20Rules%0A%0A%23%23%23%201.%20Asking%20%22Who%20is%20%E2%80%A6%3F%22%20with%20%E8%B0%81%20%28Sh%C3%A9i%29%0A-%20%2A%2AStructure%2A%2A%3A%20%5BSubject%5D%20%2B%20%E6%98%AF%20%2B%20%E8%B0%81%EF%BC%9F%0A-%20Used%20to%20inquire%20about%20someone%27s%20identity.%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E5%A5%B9%E6%98%AF%E8%B0%81%EF%BC%9F%20%28T%C4%81%20sh%C3%AC%20sh%C3%A9i%3F%29%20%E2%86%92%20%22Who%20is%20she%3F%22%0A%20%20-%20%E4%BB%96%E6%98%AF%E8%B0%81%EF%BC%9F%20%28T%C4%81%20sh%C3%AC%20sh%C3%A9i%3F%29%20%E2%86%92%20%22Who%20is%20he%3F%22%0A%0A%23%23%23%202.%20Possession%20with%20%E7%9A%84%20%28de%29%0A-%20%2A%2AStructure%2A%2A%3A%20%5BOwner%5D%20%2B%20%E7%9A%84%20%2B%20%5BPossession%5D%0A-%20Used%20to%20indicate%20possession.%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E5%A5%B9%E6%98%AF%E6%88%91%E7%9A%84%E5%90%8C%E5%AD%A6%E3%80%82%20%28T%C4%81%20sh%C3%AC%20w%C7%92%20de%20t%C3%B3ngxu%C3%A9.%29%20%E2%86%92%20%22She%20is%20my%20classmate.%22%0A%0A%23%23%23%203.%20Using%20%E5%90%97%20%28ma%29%20for%20Yes/No%20Questions%0A-%20%2A%2AStructure%2A%2A%3A%20Statement%20%2B%20%E5%90%97%EF%BC%9F%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E5%A5%B9%E6%98%AF%E4%B8%AD%E5%9B%BD%E4%BA%BA%E5%90%97%EF%BC%9F%20%28T%C4%81%20sh%C3%AC%20Zh%C5%8Dnggu%C3%B3%20r%C3%A9n%20ma%3F%29%20%E2%86%92%20%22Is%20she%20Chinese%3F%22%0A">
        </div>
    
        <hr />
        <div class="hanzi-section" 
            data-title="Dialogue 2: Talking About Language"
            data-hanzi="A: ä½ æ˜¯å­¦ç”Ÿå—ï¼Ÿ
B: æ˜¯ï¼Œæˆ‘æ˜¯å­¦ç”Ÿã€‚ä½ å‘¢ï¼Ÿ
A: æˆ‘ä¹Ÿæ˜¯å­¦ç”Ÿã€‚æˆ‘å­¦æ±‰è¯­ã€‚
B: ä½ åŒå­¦æ˜¯å“ªå›½äººï¼Ÿ
A: ä»–æ˜¯ç¾Žå›½äººã€‚" 
            data-translation="W1siQTog5L2g5piv5a2m55Sf5ZCX77yfXG4iLCJBOiBBcmUgeW91IGEgc3R1ZGVudD9cbiJdLFsiQjog5piv77yM5oiR5piv5a2m55Sf44CC5L2g5ZGi77yfXG4iLCJCOiBZZXMsIEkgYW0gYSBzdHVkZW50LiBXaGF0IGFib3V0IHlvdT9cbiJdLFsiQTog5oiR5Lmf5piv5a2m55Sf44CC5oiR5a2m5rGJ6K%2Bt44CCXG4iLCJBOiBJIGFtIGFsc28gYSBzdHVkZW50LiBJIHN0dWR5IENoaW5lc2UuXG4iXSxbIkI6IOS9oOWQjOWtpuaYr%2BWTquWbveS6uu%2B8n1xuIiwiQjogV2hhdCBuYXRpb25hbGl0eSBpcyB5b3VyIGNsYXNzbWF0ZT9cbiJdLFsiQTog5LuW5piv576O5Zu95Lq644CCIiwiQTogSGUgaXMgQW1lcmljYW4uIl1d"
            data-dictionary="eyJBIjoiKHgpICAoc2xhbmcpIChUdykgdG8gc3RlYWwiLCLkvaAiOiIocikgIHlvdSAoTm90ZTogSW4gVGFpd2FuLCDlprMgaXMgdXNlZCB0byBhZGRyZXNzIGZlbWFsZXMsIGJ1dCBpbiBtYWlubGFuZCBDaGluYSwgaXQgaXMgbm90IGNvbW1vbmx5IHVzZWQuIEluc3RlYWQsIOS9oCBpcyB1c2VkIHRvIGFkZHJlc3MgYm90aCBtYWxlcyBhbmQgZmVtYWxlcy4pIiwi5pivIjoiKHYpICB2YXJpYW50IG9mIOaYr1tzaGk0XSIsIuWtpueUnyI6IihuKSAgc3R1ZGVudCIsIuWQlyI6Iih5KSAgKHF1ZXN0aW9uIHBhcnRpY2xlIGZvciBcInllcy1ub1wiIHF1ZXN0aW9ucykiLCJCIjoiKHgpICBldXBoZW1pc3RpYyB2YXJpYW50IG9mIOWxhFtiaTFdIiwi5oiRIjoiKHIpICBJOyBtZTsgbXkiLCLkuZ8iOiIoZCkgIGFsc287IHRvbzsgYXMgd2VsbDsgKG5vdCAuLi4pIGVpdGhlciIsIuaxieivrSI6IihueikgIENoaW5lc2UgbGFuZ3VhZ2UiLCLlkIzlraYiOiIobikgIHRvIHN0dWR5IGF0IHRoZSBzYW1lIHNjaG9vbCIsIuWTqiI6IihyKSAgd2hpY2g%2FIChpbnRlcnJvZ2F0aXZlLCBmb2xsb3dlZCBieSBjbGFzc2lmaWVyIG9yIG51bWVyYWwtY2xhc3NpZmllcikiLCLlm73kuroiOiIobikgIGNvbXBhdHJpb3RzIChsaXRlcmFyeSkiLCLku5YiOiIocikgICh0aGlyZC1wZXJzb24gc2luZ3VsYXIpIChzaW5jZSB0aGUgZWFybHkgMjB0aCBjZW50dXJ5LCB1c3UuIG1hbGUpIGhlOyBoaW07IGhpcyIsIue%2BjuWbvSI6IihucykgIFVuaXRlZCBTdGF0ZXM7IFVTQTsgVVMiLCLkuroiOiIobikgIHBlcnNvbjsgcGVvcGxlIn0%3D"
            data-markdown="%0A%23%23%20Grammar%20Rules%0A%0A%23%23%23%201.%20Asking%20About%20Nationality%20with%20%E5%93%AA%E5%9B%BD%E4%BA%BA%20%28N%C7%8E%20gu%C3%B3%20r%C3%A9n%29%0A-%20%2A%2AStructure%2A%2A%3A%20%5BSubject%5D%20%2B%20%E6%98%AF%20%2B%20%E5%93%AA%E5%9B%BD%E4%BA%BA%EF%BC%9F%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E4%BD%A0%E5%90%8C%E5%AD%A6%E6%98%AF%E5%93%AA%E5%9B%BD%E4%BA%BA%EF%BC%9F%20%28N%C7%90%20t%C3%B3ngxu%C3%A9%20sh%C3%AC%20n%C7%8E%20gu%C3%B3%20r%C3%A9n%3F%29%20%E2%86%92%20%22What%20nationality%20is%20your%20classmate%3F%22%0A%0A%23%23%23%202.%20Expressing%20%22Also%22%20with%20%E4%B9%9F%20%28Y%C4%9B%29%0A-%20%2A%2AStructure%2A%2A%3A%20Subject%20%2B%20%E4%B9%9F%20%2B%20Verb%20%2B%20Object.%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E6%88%91%E4%B9%9F%E6%98%AF%E5%AD%A6%E7%94%9F%E3%80%82%20%28W%C7%92%20y%C4%9B%20sh%C3%AC%20xu%C3%A9sh%C4%93ng.%29%20%E2%86%92%20%22I%20am%20also%20a%20student.%22%0A%0A%23%23%23%203.%20Using%20%E5%AD%A6%20%28Xu%C3%A9%29%20to%20Mean%20%22To%20Learn%22%20or%20%22To%20Study%22%0A-%20%2A%2AStructure%2A%2A%3A%20Subject%20%2B%20%E5%AD%A6%20%2B%20Object.%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E6%88%91%E5%AD%A6%E6%B1%89%E8%AF%AD%E3%80%82%20%28W%C7%92%20xu%C3%A9%20H%C3%A0ny%C7%94.%29%20%E2%86%92%20%22I%20study%20Chinese.%22%0A">
        </div>
    
        <hr />
        <div class="hanzi-section" 
            data-title="Dialogue 3: Saying Goodbye to a Friend"
            data-hanzi="A: ä½ ä»¬å¥½ï¼
B: ä½ å¥½ï¼ä½ æ˜¯è°ï¼Ÿ
A: æˆ‘æ˜¯æŽæœˆçš„æœ‹å‹ã€‚ä½ æ˜¯å¥¹çš„åŒå­¦å—ï¼Ÿ
B: æ˜¯ï¼Œæˆ‘æ˜¯å¥¹çš„åŒå­¦ã€‚
A: å¥½çš„ï¼Œè°¢è°¢ï¼å†è§ï¼
B: ä¸å®¢æ°”ï¼Œå†è§ï¼" 
            data-translation="W1siQTog5L2g5Lus5aW977yBXG4iLCJBOiBIZWxsbywgZXZlcnlvbmUhXG4iXSxbIkI6IOS9oOWlve%2B8geS9oOaYr%2Biwge%2B8n1xuIiwiQjogSGVsbG8hIFdobyBhcmUgeW91P1xuIl0sWyJBOiDmiJHmmK%2FmnY7mnIjnmoTmnIvlj4vjgILkvaDmmK%2FlpbnnmoTlkIzlrablkJfvvJ9cbiIsIkE6IEkgYW0gTGkgWXVlJ3MgZnJpZW5kLiBBcmUgeW91IGhlciBjbGFzc21hdGU%2FXG4iXSxbIkI6IOaYr%2B%2B8jOaIkeaYr%2BWlueeahOWQjOWtpuOAglxuIiwiQjogWWVzLCBJIGFtIGhlciBjbGFzc21hdGUuXG4iXSxbIkE6IOWlveeahO%2B8jOiwouiwou%2B8geWGjeinge%2B8gVxuIiwiQTogT2theSwgdGhhbmtzISBHb29kYnllIVxuIl0sWyJCOiDkuI3lrqLmsJTvvIzlho3op4HvvIEiLCJCOiBZb3UncmUgd2VsY29tZSwgZ29vZGJ5ZSEiXV0%3D"
            data-dictionary="eyJBIjoiKHgpICAoc2xhbmcpIChUdykgdG8gc3RlYWwiLCJCIjoiKHgpICBldXBoZW1pc3RpYyB2YXJpYW50IG9mIOWxhFtiaTFdIiwi5L2g5aW9IjoiKGwpICBoZWxsbyIsIuS9oCI6IihyKSAgeW91IChOb3RlOiBJbiBUYWl3YW4sIOWmsyBpcyB1c2VkIHRvIGFkZHJlc3MgZmVtYWxlcywgYnV0IGluIG1haW5sYW5kIENoaW5hLCBpdCBpcyBub3QgY29tbW9ubHkgdXNlZC4gSW5zdGVhZCwg5L2gIGlzIHVzZWQgdG8gYWRkcmVzcyBib3RoIG1hbGVzIGFuZCBmZW1hbGVzLikiLCLmmK8iOiIodikgIHZhcmlhbnQgb2Yg5pivW3NoaTRdIiwi6LCBIjoiKHIpICB3aG8iLCLmiJEiOiIocikgIEk7IG1lOyBteSIsIueahCI6Iih1aikgIChib3VuZCBmb3JtKSBidWxsJ3MtZXllOyB0YXJnZXQiLCLmnIvlj4siOiIobikgIGZyaWVuZCIsIuWluSI6IihyKSAgc2hlIiwi5ZCM5a2mIjoiKG4pICB0byBzdHVkeSBhdCB0aGUgc2FtZSBzY2hvb2wiLCLlkJciOiIoeSkgIChxdWVzdGlvbiBwYXJ0aWNsZSBmb3IgXCJ5ZXMtbm9cIiBxdWVzdGlvbnMpIiwi5aW9IjoiKGEpICB0byBiZSBmb25kIG9mOyB0byBoYXZlIGEgdGVuZGVuY3kgdG87IHRvIGJlIHByb25lIHRvIiwi6LCi6LCiIjoiKG5yKSAgdG8gdGhhbmsiLCLlho3op4EiOiIodikgIGdvb2RieWUiLCLkuI0iOiIoZCkgIG5vOyBub3Qgc28iLCLlrqLmsJQiOiIobikgIHBvbGl0ZSJ9"
            data-markdown="%0A%23%23%20Grammar%20Rules%0A%0A%23%23%23%201.%20Asking%20%22Who%20Are%20You%3F%22%20with%20%E4%BD%A0%E6%98%AF%E8%B0%81%EF%BC%9F%28N%C7%90%20sh%C3%AC%20sh%C3%A9i%3F%29%0A-%20%2A%2AStructure%2A%2A%3A%20%E4%BD%A0%20%2B%20%E6%98%AF%20%2B%20%E8%B0%81%EF%BC%9F%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E4%BD%A0%E6%98%AF%E8%B0%81%EF%BC%9F%20%28N%C7%90%20sh%C3%AC%20sh%C3%A9i%3F%29%20%E2%86%92%20%22Who%20are%20you%3F%22%0A%0A%23%23%23%202.%20Saying%20Goodbye%20with%20%E5%86%8D%E8%A7%81%20%28Z%C3%A0iji%C3%A0n%29%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E5%86%8D%E8%A7%81%EF%BC%81%20%28Z%C3%A0iji%C3%A0n%21%29%20%E2%86%92%20%22Goodbye%21%22%0A%0A%23%23%23%203.%20Using%20%E7%9A%84%20%28de%29%20for%20Possession%0A-%20%2A%2AStructure%2A%2A%3A%20%5BOwner%5D%20%2B%20%E7%9A%84%20%2B%20%5BPossession%5D%0A-%20%2A%2AExample%2A%2A%3A%0A%20%20-%20%E6%88%91%E6%98%AF%E6%9D%8E%E6%9C%88%E7%9A%84%E6%9C%8B%E5%8F%8B%E3%80%82%20%28W%C7%92%20sh%C3%AC%20L%C7%90%20Yu%C3%A8%20de%20p%C3%A9ngy%C7%92u.%29%20%E2%86%92%20%22I%20am%20Li%20Yue%27s%20friend.%22%0A">
        </div>
    

    <!-- <hr />
    <div class="markdown-container"
        data-markdown="%0A%23%20Markdown%20Title%0AThis%20is%20a%20%2A%2Abold%2A%2A%20text.%20%20%0AHere%20is%20a%20list%3A%0A-%20Item%201%0A-%20Item%202%0A-%20Item%203%0A%0A%5BClick%20here%5D%28https%3A//example.com%29%20for%20a%20link.%0A"
    ></div> -->
    <!-- <hr />
    <div class="hanzi-section" 
         data-title="Hello 2"
         data-hanzi="è€å¸ˆï¼šä½ å«ä»€ä¹ˆåå­—ï¼Ÿ\nå­¦ç”Ÿï¼šæˆ‘å«å°æ˜Žã€‚\nè€å¸ˆï¼šä½ å‡ å²äº†ï¼Ÿ\nå­¦ç”Ÿï¼šæˆ‘ä¸ƒå²äº†ã€‚" 
         data-translation="Teacher: What's your name?\nStudent: My name is Xiao Ming.\nTeacher: How old are you?\nStudent: I am seven years old."
         data-dictionary="%7B%22%5Cu4f60%5Cu597d%22%3A%20%22phr.%20hello%22%2C%20%22%5Cu4eca%5Cu5929%22%3A%20%22n.%20today%22%2C%20%22%5Cu600e%5Cu4e48%5Cu6837%22%3A%20%22phr.%20how%20about%22%2C%20%22%5Cu6211%22%3A%20%22pron.%20I%2C%20me%22%2C%20%22%5Cu5f88%5Cu597d%22%3A%20%22adj.%20very%20good%22%2C%20%22%5Cu8c22%5Cu8c22%22%3A%20%22v.%20thank%20you%22%2C%20%22%5Cu4f60%5Cu5462%22%3A%20%22phr.%20and%20you%3F%22%2C%20%22%5Cu4e5f%22%3A%20%22adv.%20also%22%2C%20%22%5Cu6211%5Cu4eec%22%3A%20%22pron.%20we%2C%20us%22%2C%20%22%5Cu53bb%22%3A%20%22v.%20go%22%2C%20%22%5Cu559d%22%3A%20%22v.%20drink%22%2C%20%22%5Cu5496%5Cu5561%22%3A%20%22n.%20coffee%22%2C%20%22%5Cu5427%22%3A%20%22part.%20suggestion%20particle%22%2C%20%22%5Cu597d%5Cu554a%22%3A%20%22phr.%20okay%21%22%2C%20%22%5Cu5f20%5Cu4f1f%22%3A%20%22n.%20Zhang%20Wei%20%28a%20common%20Chinese%20name%29%22%2C%20%22%5Cu674e%5Cu5a1c%22%3A%20%22n.%20Li%20Na%20%28a%20common%20Chinese%20name%29%22%7D"
         >
    </div> -->
</div>
<!-- Pinyin Pro -->
<script src="https://cdn.jsdelivr.net/npm/pinyin-pro"></script>

<!-- Include Marked.js (Markdown parser) -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
    function isHanzi(char) {
        return /[\u4e00-\u9fff]/.test(char);
    }

    function decodeDictionary(encodedString) {
        

        const urlDecoded = decodeURIComponent(encodedString)
        const binaryString = atob(urlDecoded);
        const bytes = new Uint8Array([...binaryString].map(char => char.charCodeAt(0)));
        const decodedString = new TextDecoder().decode(bytes)
        const dictionary = JSON.parse(decodedString);

        console.log(dictionary)
        return dictionary;
        
    ;
    }

    let activePopover = null; // Track the currently open popover

    function generateMarkdowns() {
        document.querySelectorAll(".markdown-container").forEach(markdownSection => {
            dataMarkdown = decodeURIComponent(markdownSection.getAttribute("data-markdown"));
            markdownSection.innerHTML = marked.parse(dataMarkdown);
        })
    }


    function generateSections() {
        document.querySelectorAll(".new-words-section").forEach(newWordsSection => {
            const dataDictionary = decodeDictionary(newWordsSection.getAttribute("data-dictionary"))
            newWordsSection.innerHTML = "";
            const newWordsDialog = document.createElement("div");
            newWordsDialog.classList.add("dialog-new-words");

            const title = document.createElement("p");
            title.classList.add("hanzi-line")

            const titleSpan = document.createElement("span");
            titleSpan.classList.add("plain-text-title");
            titleSpan.textContent = "New Words";
            title.appendChild(titleSpan);
            newWordsDialog.appendChild(title);

            for(let word in dataDictionary) {
                const entry = document.createElement("p");
                entry.classList.add("hanzi-line");
                createHanziSpan(entry, word, dataDictionary);

                const pinyinSpan = document.createElement("span");
                pinyinSpan.classList.add("pinyin-dictionary");
                pinyinSpan.textContent = "   " + (pinyinPro.pinyin(word, { toneType: "mark" }) || "")
                entry.appendChild(pinyinSpan);


                const entrySpan = document.createElement("span");
                entrySpan.classList.add("plain-text");
                entrySpan.textContent = "  :  " + dataDictionary[word];
                entry.appendChild(entrySpan)
                newWordsDialog.appendChild(entry)
            }
            newWordsSection.replaceWith(newWordsDialog);
        })

        document.querySelectorAll(".hanzi-section").forEach(section => {
            const hanziText = section.getAttribute("data-hanzi");
            const textCouples = section.getAttribute("data-translation");
            const dataDictionary = decodeDictionary(section.getAttribute("data-dictionary"))
            const dataTitle = section.getAttribute("data-title");
            const dataMarkdown = section.getAttribute("data-markdown");

            const sectionDiv = document.createElement("div");
            sectionDiv.classList.add("dialog-container");

            generateDialogFromText(sectionDiv, dataTitle, textCouples, dataDictionary, dataMarkdown);

            section.replaceWith(sectionDiv);
        });

        updatePinyinDisplay();
        updateTranslationDisplay();
        initializePopovers();
    }

    function generateDialogFromText(contentDiv, dataTitle, textCouples, dataDictionary, dataMarkdown) {
        contentDiv.innerHTML = ""; // Clear previous content


        const titleDialog = document.createElement("div");
        titleDialog.classList.add("dialog")

        const title = document.createElement("p");
        title.classList.add("hanzi-line")

        const titleSpan = document.createElement("span");
        titleSpan.classList.add("plain-text-title");
        titleSpan.textContent = dataTitle;

        title.appendChild(titleSpan);
        titleDialog.appendChild(title);
        contentDiv.appendChild(titleDialog);  

        const urlDecoded = decodeURIComponent(textCouples)
        const binaryString = atob(urlDecoded);
        const bytes = new Uint8Array([...binaryString].map(char => char.charCodeAt(0)));
        const decodedString = new TextDecoder().decode(bytes)
        const translations = JSON.parse(decodedString);

        translations.forEach((translationGroup, index) => {
            const container = document.createElement("div");
            container.classList.add("dialog");

            const paragraph = document.createElement("p");
            paragraph.classList.add("hanzi-line");

            line = translationGroup[0] // Hanzi
            let indexChar = 0;
            while (indexChar < line.length) {
                let foundWord = false;

                for (let word in dataDictionary) {
                    if (line.startsWith(word, indexChar)) {
                        createHanziSpan(paragraph, word, dataDictionary);
                        indexChar += word.length;
                        foundWord = true;
                        break;
                    }
                }

                if (!foundWord) {
                    let char = line[indexChar];

                    if (isHanzi(char)) {
                        createHanziSpan(paragraph, char, dataDictionary);
                    } else {
                        createPlainTextSpan(paragraph, char);
                    }
                    indexChar++;
                }
            }
            container.appendChild(paragraph);

            // Create translation line
            const translationPara = document.createElement("p");
            translationPara.classList.add("translation");
            translationPara.textContent = translationGroup[1].trim(); // Translation
            container.appendChild(translationPara);
            

            contentDiv.appendChild(container);
        });

        if(dataMarkdown !== null) {
            markdownContainer = document.createElement("div");
            markdownContainer.classList.add("section-markdown-container");
            markdownContent = document.createElement("div");
            markdownContent.innerHTML = marked.parse(decodeURIComponent(dataMarkdown));
            markdownContainer.appendChild(markdownContent);
            contentDiv.appendChild(markdownContainer);
            
        }

        // updatePinyinDisplay();
        // updateTranslationDisplay();
        // initializePopovers(); // **Fix: Ensure popovers are initialized**
    }

    function createHanziSpan(parent, hanziWord, dataDictionary) {
        const pinyinText = pinyinPro.pinyin(hanziWord, { toneType: "mark" }) || "";
        const definition = dataDictionary[hanziWord] || "No definition available";

        const span = document.createElement("span");
        span.classList.add("hanzi-group");
        span.dataset.pinyin = pinyinText;
        span.dataset.bsToggle = "popover";
        span.dataset.bsTrigger = "manual"; 
        span.dataset.bsPlacement = "top";
        span.dataset.bsContent = `<strong>${hanziWord}</strong><br>${pinyinText}<br>${definition}`;
        span.dataset.bsHtml = "true";

        if (pinyinText) {
            const pinyinSpan = document.createElement("span");
            pinyinSpan.classList.add("pinyin");
            pinyinSpan.textContent = pinyinText;
            span.appendChild(pinyinSpan);
        }

        span.appendChild(document.createTextNode(hanziWord));
        parent.appendChild(span);
    }

    function createPlainTextSpan(parent, text) {
        const span = document.createElement("span");
        span.classList.add("plain-text");
        span.textContent = text;
        parent.appendChild(span);
    }

    function updatePinyinDisplay() {
        const isPinyinEnabled = localStorage.getItem("showPinyin") === "true";
        document.querySelectorAll(".dialog-container").forEach(section => {
            section.classList.toggle("show-pinyin", isPinyinEnabled);
        });
        document.getElementById("togglePinyin").checked = isPinyinEnabled;
    }

    function updateTranslationDisplay() {
        const isTranslationEnabled = localStorage.getItem("showTranslation") === "true";
        document.querySelectorAll(".dialog-container").forEach(section => {
            section.classList.toggle("show-translation", isTranslationEnabled);
        });
        document.getElementById("toggleTranslation").checked = isTranslationEnabled;
    }

    document.getElementById("togglePinyin").addEventListener("change", function () {
        localStorage.setItem("showPinyin", this.checked);
        updatePinyinDisplay();
    });

    document.getElementById("toggleTranslation").addEventListener("change", function () {
        localStorage.setItem("showTranslation", this.checked);
        updateTranslationDisplay();
    });

    function initializePopovers() {
        document.querySelectorAll('[data-bs-toggle="popover"]').forEach(el => {
            const popover = new bootstrap.Popover(el);

            el.addEventListener("click", function (event) {
                event.stopPropagation();

                if (activePopover && activePopover !== popover) {
                    activePopover.hide();
                }

                if (activePopover === popover) {
                    activePopover.hide();
                    activePopover = null;
                } else {
                    popover.show();
                    activePopover = popover;
                }
            });
        });

        // Close popovers when clicking outside
        document.addEventListener("click", function (event) {
            if (activePopover && !event.target.closest(".hanzi-group")) {
                activePopover.hide();
                activePopover = null;
            }
        });
    }

    // generateDialogFromText(textBlob, translation);
    generateSections()
    generateMarkdowns()
</script>
    </div>
<footer class="bg-light text-center py-3 mt-4">
    <div class="container">
        <p>&copy; 2025 Made with ðŸ’– by <a href="https://github.com/shadowcodex">shadowcodex</a></p>
    </div>
</footer>
</body>
</html>
